!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(global,(function(){return function(){"use strict";var e={15:function(e){e.exports=require("html-minifier-terser")},260:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(s=2&a[0]?n.return:a[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,a[1])).done)return s;switch(n=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,s,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return o},a=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,s=0,i=t.length;s<i;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=u(r(943)),l=u(r(928)),h=u(r(982)),f=u(r(889)),p=u(r(15)),d=u(r(878)),y=u(r(817)),m=u(r(872));t.default=function(e){var t=this;this.name="Htmlwp",this.fileDependencies=new Map,this.cssFileNameHashes=new Map,this.isProductionMode=!1,this.apply=function(e){t.logger=e.getInfrastructureLogger(t.name),e.hooks.done.tapAsync(t.name,(function(e,r){return n(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.stats=e,this.isProductionMode="production"===this.stats.compilation.compiler.options.mode,[4,this.handleExternalAssets()];case 1:return t.sent(),e.compilation.fileDependencies.addAll(Array.from(this.fileDependencies.values()).flat()),r(),[2]}}))}))}))},this.handleExternalAssets=function(){return n(t,void 0,void 0,(function(){var e,t,r,n,a,u,c,l,h,f,p,d,y,m,v;return s(this,(function(s){switch(s.label){case 0:if(s.trys.push([0,15,,16]),!(e=this.getModifiedFile()))return[3,9];s.label=1;case 1:s.trys.push([1,6,7,8]),t=i(this.fileDependencies),r=t.next(),s.label=2;case 2:return r.done?[3,5]:(n=o(r.value,2),a=n[0],n[1].includes(e)?[4,this.hate(a)]:[3,4]);case 3:s.sent(),s.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return u=s.sent(),m={error:u},[3,8];case 7:try{r&&!r.done&&(v=t.return)&&v.call(t)}finally{if(m)throw m.error}return[7];case 8:return[2];case 9:for(h in c=this.options.entry,l=[],c)l.push(h);f=0,s.label=10;case 10:return f<l.length?(h=l[f])in c?(p=h,"srcPath"in(d=this.options.entry[p])&&d.destPath?[4,this.copyMoveFolderAsync(d.srcPath,d.destPath)]:[3,12]):[3,12]:[3,13];case 11:s.sent(),s.label=12;case 12:return f++,[3,10];case 13:return[4,this.hate()];case 14:return s.sent(),[3,16];case 15:return y=s.sent(),this.logger.error(y),[3,16];case 16:return[2]}}))}))},this.hate=function(e){return n(t,void 0,void 0,(function(){var t,r,n,i,o,a,u,c,l,h;return s(this,(function(s){switch(s.label){case 0:for(o in(t=this.options.entry.global)&&t.import&&(t=void 0),r=!1,n=this.options.entry,i=[],n)i.push(o);a=0,s.label=1;case 1:if(!(a<i.length))return[3,10];if(!((o=i[a])in n))return[3,9];if(u=o,"srcPath"in(c=this.options.entry[u]))return[3,9];if(!Array.isArray(c.styles))return[3,7];l=0,s.label=2;case 2:return l<c.styles.length?(h=c.styles[l],r||!this.stats.compilation.outputOptions.clean?[3,4]:[4,this.cleanCssFiles(h.filename)]):[3,7];case 3:s.sent(),r=!0,s.label=4;case 4:return e&&h.import!==e?[3,6]:[4,this.bundleCss(h)];case 5:if(s.sent(),e)return[3,10];s.label=6;case 6:return l++,[3,2];case 7:return c.import&&c.filename?e&&e!==c.import?[3,9]:[4,this.bundleHtml(c,t)]:[3,9];case 8:if(s.sent(),e)return[3,10];s.label=9;case 9:return a++,[3,1];case 10:return[2]}}))}))},this.cleanCssFiles=function(e){return n(t,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=l.default.dirname(this.resolvePath([this.getOutputPath(),e])),[4,c.default.rm(t,{recursive:!0})];case 1:case 2:return r.sent(),[3,3];case 3:return[2]}}))}))},this.bundleHtml=function(e,r){return n(t,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=this.htmlFileBundler.bundle(e.import),this.isProductionMode?[4,this.minify(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return r&&Array.isArray(r.styles)&&this.injectLinkTags(t,r.styles),Array.isArray(e.styles)&&this.injectLinkTags(t,e.styles),r&&Array.isArray(null==r?void 0:r.jschunks)&&this.injectScriptTags(t,r.jschunks),Array.isArray(e.jschunks)&&this.injectScriptTags(t,e.jschunks),this.fileDependencies.set(e.import,t.filePathNames),[4,this.output(e.filename,t)];case 3:return n.sent(),[2]}}))}))},this.injectLinkTags=function(e,r){for(var n="",s=0;s<r.length;s++){var i=r[s],o=("/"+(t.cssFileNameHashes.get(i.import)||i.filename)).replace(/[\\/]+/g,"/");n+='<link rel="stylesheet" href="'.concat(o,'">')}e.source=e.source.replace(/<\/head>/,n+"</head>")},this.injectScriptTags=function(e,r){for(var n,s,u=new Map,c=0;c<r.length;c++){var l=r[c],h=t.stats.compilation.namedChunks.get(l.name);if(h){var f=("/"+a([],o(h.files),!1)[0]).replace(/[\\/]+/g,"/"),p=Object.entries(l.attributes||{}).map((function(e){return"".concat(e[0]).concat("string"==typeof e[1]?'="'+e[1]+'"':"")})).join(" ");u.set(l.inject||"body","<script ".concat(p,' src="').concat(f,'"><\/script>').replace(/\s+/g," "))}}try{for(var d=i(u),y=d.next();!y.done;y=d.next()){var m=o(y.value,2),v=m[0],b=m[1];if("head"===v)e.source=e.source.replace(/<\/head>/,b+"</head>");else{var g=e.source.lastIndexOf("</body>");if(-1===g)continue;e.source=e.source.slice(0,g)+b+e.source.slice(g)}}}catch(e){n={error:e}}finally{try{y&&!y.done&&(s=d.return)&&s.call(d)}finally{if(n)throw n.error}}},this.bundleCss=function(e){return n(t,void 0,void 0,(function(){var t,r,n,i=this;return s(this,(function(s){switch(s.label){case 0:return t=d.default.compile(e.import,{style:this.isProductionMode?"compressed":void 0,alertColor:!1}),(r={source:t.css,filePathNames:[]}).filePathNames=t.loadedUrls.map((function(e){return i.resolvePath([e.pathname])})),this.isProductionMode&&(r.source=(0,y.default)([m.default]).process(r.source,{from:void 0}).css),n=e.filename,e.filename.includes("[contenthash]")&&(n=e.filename.replace("[contenthash]",h.default.createHash("md5").update(r.source).digest("hex").slice(0,24)),this.cssFileNameHashes.set(e.import,n)),this.fileDependencies.set(e.import,r.filePathNames),[4,this.output(n,r)];case 1:return s.sent(),[2]}}))}))},this.resolvePath=function(e){return e.forEach((function(t,r){return e[r]=t.split(/[\\|\/]+/).filter((function(e){return e})).join("/")})),l.default.resolve.apply(l.default,a([],o(e),!1))},this.copyMoveFolderAsync=function(e,r){return n(t,void 0,void 0,(function(){var t,i,o,a=this;return s(this,(function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),t=this.options.outputPath||this.stats.compilation.outputOptions.path||"dist",[4,this.makeDirIfNotExists(this.resolvePath([t,r]))];case 1:return u.sent(),[4,c.default.readdir(e)];case 2:return i=u.sent(),[4,Promise.all(i.map((function(i){return n(a,void 0,void 0,(function(){var n,o,a,u;return s(this,(function(s){switch(s.label){case 0:return n=this.resolvePath([e,i]),o=this.resolvePath([t,r,i]),[4,c.default.stat(n)];case 1:return s.sent().isDirectory()?[4,this.copyMoveFolderAsync(n,o)]:[3,3];case 2:return s.sent(),[3,8];case 3:return i.endsWith(".json")&&this.isProductionMode?[4,c.default.readFile(n,"utf8")]:[3,6];case 4:return a=s.sent(),u=JSON.stringify(JSON.parse(a)),[4,c.default.writeFile(o,u,"utf8")];case 5:return s.sent(),[3,8];case 6:return[4,c.default.copyFile(n,o)];case 7:s.sent(),s.label=8;case 8:return[2]}}))}))})))];case 3:return u.sent(),[3,5];case 4:return o=u.sent(),this.logger.error(o),[3,5];case 5:return[2]}}))}))},this.getModifiedFile=function(){var e=t.stats.compilation.compiler.modifiedFiles;return e&&a([],o(e),!1)[0]||null},this.minify=function(e){return n(t,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:return t=this.options.htmlMinifyOptions||{removeComments:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,removeRedundantAttributes:!0,collapseWhitespace:!0,keepClosingSlash:!0,useShortDoctype:!0,minifyCSS:!0,minifyJS:!0},r=e,[4,p.default.minify(e.source,t)];case 1:return r.source=n.sent(),[2]}}))}))},this.output=function(e,r){return n(t,void 0,void 0,(function(){var t,n,i,o;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),t=this.getOutputPath(),e=this.resolvePath([t,e]),n=e,l.default.basename(e)&&(n=l.default.dirname(e)),[4,this.makeDirIfNotExists(n)];case 1:return s.sent(),[4,c.default.writeFile(e,r.source)];case 2:return s.sent(),[3,4];case 3:return i=s.sent(),o=i,this.logger.error(o),[3,4];case 4:return[2]}}))}))},this.getOutputPath=function(){return t.options.outputPath||t.stats.compilation.outputOptions.path||"dist"},this.fileExists=function(e){return n(t,void 0,void 0,(function(){var t;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c.default.access(e)];case 1:return r.sent(),[2,!0];case 2:if("ENOENT"===(t=r.sent()).code)return[2,!1];throw t;case 3:return[2]}}))}))},this.makeDirIfNotExists=function(e){return n(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.fileExists(e)];case 1:return t.sent()?[2]:[4,c.default.mkdir(e,{recursive:!0})];case 2:return t.sent(),[2]}}))}))},this.options=e,this.htmlFileBundler=new f.default({className:this.options.htmlIncludePrefixName||this.name,pattern:"include",includeProperties:this.options.htmlIncludeProperties})}},817:function(e){e.exports=require("postcss")},872:function(e){e.exports=require("autoprefixer")},878:function(e){e.exports=require("sass")},889:function(e){e.exports=require("file-bundler")},928:function(e){e.exports=require("path")},943:function(e){e.exports=require("fs/promises")},982:function(e){e.exports=require("crypto")}},t={},r=function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(260);return r.default}()}));